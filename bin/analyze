#!/usr/bin/env node

const cli = require('commander')
const log = require('debug')('nc-scanner:analzer')

const { version } = require('../package.json')
const Program = require('../dist')

cli.version(version)
  .description('An app for analyzing NC files')
  .option('-c --canned-cycles', 'Show found canned cycles in toolpaths')
  .option('-p --canned-points', 'Show the location of points in canned cycles')
  .parse(process.argv)

if (cli.args.length === 0) {
  process.stderr.write('ERR: You must provide the path to a NC file')
  cli.help()
  process.abort()
}

(async (args) => {
  const program = new Program(cli.args[0])

  try {
    await program.process()

    program.describe({
      cannedCycles: cli.cannedCycles,
      cannedPoints: cli.cannedPoints
    })

    log(`Analyzed ${program.toolpaths.length} toolpaths.`)
  } catch (err) {
    console.log(err)
  }
})(cli)
