#!/usr/bin/env node

const cli = require('commander')
const pkg = require('../package.json')
const NcScanner = require('../index.js')

// noinspection HtmlDeprecatedTag
cli.version(pkg.version)
  .description('An app for scanning directories and analyzing NC files')
  .option('-t, --describe-toolpaths', 'Analyze and describe the toolpaths')
  .option('-o, --output-file <file>', 'Path to log file to write output')
  .option('-w, --whitelist <dirs>', 'Whitelist of dirs to scan', val => val.split(','))
  .parse(process.argv)

try {
  if (cli.args.length === 0) {
    process.stderr.write('ERR: You must provide a path to scan')
    process.abort()
  }

  const vault = new NcScanner(cli.args[0], {
    whitelist: cli.whitelist,
    describeToolpaths: cli.describeToolpaths,
  })

  vault.scan().then((files) => {
    console.log(`Analyzed ${files[0].toolpaths.length} toolpaths in ${files.length} NC files`)

    files[0].toolpaths.forEach(toolpath => console.log(toolpath.cannedCycle))
    // console.log(files[0].blocks)
  })
} catch (err) {
  console.log(err)
  cli.help()
}
