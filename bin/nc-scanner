#!/usr/bin/env node

/**
 * Module dependencies.
 */
const cli = require('commander')
const pkg = require('../package.json')
const NcScanner = require('../index.js')

/**
 * Configure CLI interface.
 */
cli.version(pkg.version)
   .description('An app for scanning directories and analyzing NC files')
  //  .option('-d, --dir <dir>', 'Directory of NC files to analyze') Mandatory
   .option('-t, --describe-toolpaths', 'Analyze and describe the toolpaths')
   .option('-o, --output-file <file>', 'Path to log file to write output')
   .option('-w, --whitelist <dirs>', 'Whitelist of dirs to scan', val => val.split(','))
   .parse(process.argv)


// if (cli.args.length === 0)
// process.stdout.write(cli)


try {
  const vault = new NcScanner(cli.args[0], {
    describeToolpaths: cli.describeToolpaths,
    whitelist: cli.whitelist || [
      'RD PARTS',
      'HB PARTS',
      'JOB SPECIFIC',
    ],
  })

  if (cli.args.length === 0) {
    process.stderr.write('ERR: You must provide a path to scan')
    process.abort()
  }

  vault.process(() => {
    process.stdout.write(`\nAnalyzed ${vault.getToolpathCount()} toolpaths in ${vault.getFileCount()} NC files`)

    console.log(vault.files[0].blocks)
  })
} catch (err) {
  process.stderr.write(err)
  cli.help()
}
