#!/usr/bin/env node

const cli = require('commander')
const pkg = require('../package.json')
const NcScanner = require('../index.js')

// noinspection HtmlDeprecatedTag
cli.version(pkg.version)
  .description('An app for scanning directories and analyzing NC files')
  .option('-t, --describe-toolpaths', 'Analyze and describe the toolpaths')
  .option('-o, --output-file <file>', 'Path to log file to write output')
  .option('-w, --whitelist <dirs>', 'Whitelist of dirs to scan', val => val.split(','))
  .parse(process.argv)

try {
  if (cli.args.length === 0) {
    process.stderr.write('ERR: You must provide a path to scan')
    process.abort()
  }

  const vault = new NcScanner(cli.args[0], {
    describeToolpaths: cli.describeToolpaths,
    whitelist: cli.whitelist || [],
  })

  vault.process(() => {
    console.log(`Analyzed ${vault.getToolpathCount()} toolpaths in ${vault.getFileCount()} NC files`)

    console.log(vault.files[0].blocks)
  })
} catch (err) {
  console.log(err)
  cli.help()
}
